(e=>{let t;if(!Array.isArray(e))return;let s=Symbol("reexported objects");function r(e){this.m=e,this.e=e.exports}let n=r.prototype,o=Object.prototype.hasOwnProperty,i="undefined"!=typeof Symbol&&Symbol.toStringTag;function a(e,t,s){o.call(e,t)||Object.defineProperty(e,t,s)}function l(e,t){let s=e[t];return s||(s=u(t),e[t]=s),s}function u(e){return{exports:{},error:void 0,loaded:!1,id:e,namespaceObject:void 0,[s]:void 0}}function c(e,t){for(let s in a(e,"__esModule",{value:!0}),i&&a(e,i,{value:"Module"}),t){let r=t[s];Array.isArray(r)?a(e,s,{get:r[0],set:r[1],enumerable:!0}):a(e,s,{get:r,enumerable:!0})}Object.seal(e)}n.s=function(e,t){let s=this.m,r=this.e;null!=t&&(r=(s=l(this.c,t)).exports),s.namespaceObject=s.exports,c(r,e)},n.j=function(e,t){var r,n;let i,a=this.m,u=this.e;null!=t&&(u=(a=l(this.c,t)).exports),r=a,n=u,(i=r[s])||(i=r[s]=[],r.exports=r.namespaceObject=new Proxy(n,{get(e,t){if(o.call(e,t)||"default"===t||"__esModule"===t)return Reflect.get(e,t);for(let e of i){let s=Reflect.get(e,t);if(void 0!==s)return s}},ownKeys(e){let t=Reflect.ownKeys(e);for(let e of i)for(let s of Reflect.ownKeys(e))"default"===s||t.includes(s)||t.push(s);return t}})),"object"==typeof e&&null!==e&&a[s].push(e)},n.v=function(e,t){let s=this.m;null!=t&&(s=l(this.c,t)),s.exports=e},n.n=function(e,t){let s=this.m;null!=t&&(s=l(this.c,t)),s.exports=s.namespaceObject=e};let f=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,h=[null,f({}),f([]),f(f)];function m(e,t,s){let r=Object.create(null);for(let t=e;("object"==typeof t||"function"==typeof t)&&!h.includes(t);t=f(t))for(let s of Object.getOwnPropertyNames(t))r[s]=function(e,t){return()=>e[t]}(e,s);return s&&"default"in r||(r.default=()=>e),c(t,r),t}function d(e){return"function"==typeof e?function(...t){return e.apply(this,t)}:Object.create(null)}function p(){let e,t;return{promise:new Promise((s,r)=>{t=r,e=s}),resolve:e,reject:t}}n.i=function(e){let t=$(e,this.m);if(t.error)throw t.error;if(t.namespaceObject)return t.namespaceObject;let s=t.exports;return t.namespaceObject=m(s,d(s),s&&s.__esModule)},n.A=function(e){return this.r(e)(this.i.bind(this))},n.t="function"==typeof require?require:function(){throw Error("Unexpected use of runtime require")},n.r=function(e){let t=$(e,this.m);if(t.error)throw t.error;return t.exports},n.f=function(e){function t(t){if(o.call(e,t))return e[t].module();let s=Error(`Cannot find module '${t}'`);throw s.code="MODULE_NOT_FOUND",s}return t.keys=()=>Object.keys(e),t.resolve=t=>{if(o.call(e,t))return e[t].id();let s=Error(`Cannot find module '${t}'`);throw s.code="MODULE_NOT_FOUND",s},t.import=async e=>await t(e),t};let g=Symbol("turbopack queues"),y=Symbol("turbopack exports"),b=Symbol("turbopack error");function v(e){e&&1!==e.status&&(e.status=1,e.forEach(e=>e.queueCount--),e.forEach(e=>e.queueCount--?e.queueCount++:e()))}n.a=function(e,t){let s=this.m,r=t?Object.assign([],{status:-1}):void 0,n=new Set,{resolve:o,reject:i,promise:a}=p(),l=Object.assign(a,{[y]:s.exports,[g]:e=>{r&&e(r),n.forEach(e),l.catch(()=>{})}}),u={get:()=>l,set(e){e!==l&&(l[y]=e)}};Object.defineProperty(s,"exports",u),Object.defineProperty(s,"namespaceObject",u),e(function(e){let t=e.map(e=>{if(null!==e&&"object"==typeof e){if(g in e)return e;if(null!=e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then){let t=Object.assign([],{status:0}),s={[y]:{},[g]:e=>e(t)};return e.then(e=>{s[y]=e,v(t)},e=>{s[b]=e,v(t)}),s}}return{[y]:e,[g]:()=>{}}}),s=()=>t.map(e=>{if(e[b])throw e[b];return e[y]}),{promise:o,resolve:i}=p(),a=Object.assign(()=>i(s),{queueCount:0});function l(e){e!==r&&!n.has(e)&&(n.add(e),e&&0===e.status&&(a.queueCount++,e.push(a)))}return t.map(e=>e[g](l)),a.queueCount?o:s()},function(e){e?i(l[b]=e):o(l[y]),v(r)}),r&&-1===r.status&&(r.status=0)};let S=function(e){let t=new URL(e,"x:/"),s={};for(let e in t)s[e]=t[e];for(let t in s.href=e,s.pathname=e.replace(/[?#].*/,""),s.origin=s.protocol="",s.toString=s.toJSON=(...t)=>e,s)Object.defineProperty(this,t,{enumerable:!0,configurable:!0,value:s[t]})};function M(e,t){throw Error(`Invariant: ${t(e)}`)}S.prototype=URL.prototype,n.U=S,n.z=function(e){throw Error("dynamic usage of require is not supported")};let w=r.prototype;var C,T=((C=T||{})[C.Runtime=0]="Runtime",C[C.Parent=1]="Parent",C[C.Update=2]="Update",C);let E=Object.create(null);n.M=E;let R=Promise.resolve(void 0),_=new WeakMap;function j(e){return`${e.split("/").map(e=>encodeURIComponent(e)).join("/")}`}w.L=function(e){return function(e,s,r){let n=t.loadChunkCached(1,s,r),o=_.get(n);if(void 0===o){let e=_.set.bind(_,n,R);o=n.then(e).catch(e=>{let t;t=`from module ${s}`;throw Error(`Failed to load chunk ${r} ${t}${e?`: ${e}`:""}`,e?{cause:e}:void 0)}),_.set(n,o)}return o}(1,this.m.id,e)},w.R=function(e){let t=this.r(e);return t?.default??t},w.P=function(e){return`/ROOT/${e??""}`};let O=/\.js(?:\?[^#]*)?(?:#.*)?$/,x={};n.c=x;let $=(e,t)=>{let s=x[e];return s||q(e,T.Parent,t.id)};function q(e,t,s){let n=E[e];"function"!=typeof n&&function(e,t,s){let r;switch(t){case 0:r=`as a runtime entry of chunk ${s}`;break;case 1:r=`because it was required from module ${s}`;break;case 2:r="because of an HMR update";break;default:M(t,e=>`Unknown source type: ${e}`)}throw Error(`Module ${e} was instantiated ${r}, but the module factory is not available. It might have been deleted in an HMR update.`)}(e,t,s);let o=u(e);x[e]=o;try{let e=new r(o);n(e)}catch(e){throw o.error=e,e}return o.loaded=!0,o.namespaceObject&&o.exports!==o.namespaceObject&&m(o.exports,o.namespaceObject),o}function k([e,s,r]){let n=function(e){if("string"==typeof e)return e;let t=decodeURIComponent(("undefined"!=typeof TURBOPACK_NEXT_CHUNK_URLS?TURBOPACK_NEXT_CHUNK_URLS.pop():e.getAttribute("src")).replace(/[?#].*$/,"")),s=t.startsWith("")?t.slice(0):t;return s.startsWith("/")&&(s=s.slice(1)),s}(e);for(let[e,t]of Object.entries(s))!function(e,t){if(!E[e])if(Array.isArray(t)){let[s,r]=t;for(let t of(E[e]=s,r))E[t]=s}else E[e]=t}(e,t);return t.registerChunk(n,r)}function P(e,t,s=!1){let r;try{r=t()}catch(t){throw Error(`Failed to load external module ${e}: ${t}`)}return!s||r.__esModule?r:m(r,d(r),!0)}n.y=async function(e){let t;try{t=await import(e)}catch(t){throw Error(`Failed to load external module ${e}: ${t}`)}return t&&t.__esModule&&t.default&&"default"in t.default?m(t.default,d(t),!0):t},P.resolve=(e,t)=>require.resolve(e,t),n.x=P;let A=new Map;function I(e){let t=A.get(e);if(!t){let s,r;t={resolved:!1,loadingStarted:!1,promise:new Promise((e,t)=>{s=e,r=t}),resolve:()=>{t.resolved=!0,s()},reject:r},A.set(e,t)}return t}t={registerChunk(e,t){if(I(j(e)).resolve(),null!=t){for(let e of t.otherChunks)I(j("string"==typeof e?e:e.path));if(t.runtimeModuleIds.length>0)for(let s of t.runtimeModuleIds)!function(e,t){let s=x[t];if(s){if(s.error)throw s.error;return}q(t,T.Runtime,e)}(e,s)}},loadChunkCached:(e,t,s)=>(function(e,t,s){let r=I(s);if(r.loadingStarted)return r.promise;if(e===T.Runtime)return r.loadingStarted=!0,r.promise;if("function"==typeof importScripts)if(O.test(s))self.TURBOPACK_NEXT_CHUNK_URLS.push(s),importScripts(TURBOPACK_WORKER_LOCATION+s);else throw Error(`can't infer type of chunk from URL ${s} in worker`);else{let e=decodeURI(s);if(O.test(s)){let t=document.querySelectorAll(`script[src="${s}"],script[src^="${s}?"],script[src="${e}"],script[src^="${e}?"]`);if(t.length>0)for(let e of Array.from(t))e.addEventListener("error",()=>{r.reject()});else{let e=document.createElement("script");e.src=s,e.onerror=()=>{r.reject()},document.head.appendChild(e)}}else throw Error(`can't infer type of chunk from URL ${s}`)}return r.loadingStarted=!0,r.promise})(e,0,s)};let L=e;function U(){let e=["643"];if(e.length>0){let t=x[e[0]];if(t.error)throw t.error;if(t.namespaceObject)return t.namespaceObject;let s=t.exports;return t.namespaceObject=m(s,d(s),s&&s.__esModule)}}e={push:k},L.forEach(k),"object"==typeof exports&&"object"==typeof module?module.exports=U():"object"==typeof exports?exports.XSDK=U():globalThis.XSDK=U()})([["x-sdk.min.js",{571:e=>{"use strict";let t;t="object"==typeof exports&&"object"==typeof module?e.x("react",()=>require("react")):globalThis.React,e.v(t)},652:(e,t,s)=>{"use strict";var r,n=Symbol.for("react.element"),o=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),c=Symbol.for("react.context"),f=Symbol.for("react.server_context"),h=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen");function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case i:case l:case a:case m:case d:return e;default:switch(e=e&&e.$$typeof){case f:case c:case h:case g:case p:case u:return e;default:return t}}case o:return t}}}r=Symbol.for("react.module.reference"),s.ContextConsumer=c,s.ContextProvider=u,s.Element=n,s.ForwardRef=h,s.Fragment=i,s.Lazy=g,s.Memo=p,s.Portal=o,s.Profiler=l,s.StrictMode=a,s.Suspense=m,s.SuspenseList=d,s.isAsyncMode=function(){return!1},s.isConcurrentMode=function(){return!1},s.isContextConsumer=function(e){return b(e)===c},s.isContextProvider=function(e){return b(e)===u},s.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},s.isForwardRef=function(e){return b(e)===h},s.isFragment=function(e){return b(e)===i},s.isLazy=function(e){return b(e)===g},s.isMemo=function(e){return b(e)===p},s.isPortal=function(e){return b(e)===o},s.isProfiler=function(e){return b(e)===l},s.isStrictMode=function(e){return b(e)===a},s.isSuspense=function(e){return b(e)===m},s.isSuspenseList=function(e){return b(e)===d},s.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===l||e===a||e===m||e===d||e===y||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===p||e.$$typeof===u||e.$$typeof===c||e.$$typeof===h||e.$$typeof===r||void 0!==e.getModuleId)||!1},s.typeOf=b},24:(e,t,s)=>{"use strict";t.exports=e.r(652)},643:e=>{"use strict";e.s([],584),e.i(584),e.s([],469),e.i(469);class t{_request;_getMessagesFn;_originalCallbacks;get request(){return this._request}constructor(e){const t="function"==typeof e.request?e.request():e.request;if(!t.manual)throw Error("request must be manual");this._request=t,this._originalCallbacks=this._request.options?.callbacks}getMessages(){return this?._getMessagesFn()}injectGetMessages(e){this._getMessagesFn=e}injectRequest({onUpdate:e,onSuccess:t,onError:s}){let r=this._originalCallbacks?.onUpdate,n=this._originalCallbacks?.onSuccess,o=this._originalCallbacks?.onError;this._request.options.callbacks={onUpdate:(t,s)=>{let n=e(t,s);r&&r(t,s,n)},onSuccess:(e,s)=>{let r=t(e,s);n&&n(e,s,r)},onError:(e,t,r)=>{let n=s(e,t);o&&o(e,t,r,n)}}}}class s extends t{transformParams(e,t){return{...t?.params||{},...e,messages:this.getMessages()}}transformLocalMessage(e){return e?.messages||[]}transformMessage(e){let{originMessage:t,chunk:s,responseHeaders:r}=e,n="",o="",i="assistant";try{let e;r.get("content-type")?.includes("text/event-stream")?s&&s.data?.trim()!=="[DONE]"&&(e=JSON.parse(s.data)):e=s,e&&e?.choices?.forEach(e=>{e?.delta?(o=e.delta.reasoning_content||"",n+=e.delta.content||"",i=e.delta.role):e?.message&&(o=e.message.reasoning_content||"",n+=e.message.content||"",i=e.message.role)})}catch(e){console.error("transformMessage error",e)}let a="",l="string"==typeof t?.content?t?.content:t?.content.text||"";return!l&&o?a=`

<think>

${o?.replace?.(/^\n{0,2}/,"")}`:l.includes("<think>")&&!l.includes("</think>")&&n?(l=l.replace("<think>",'<think status="done">'),a=`${l?.replace?.(/[\s\n]{0,2}$/,"")}

</think>

${n}`):a=`${l||""}${o}${n}`,{content:a,role:i||"assistant"}}}class r extends t{transformParams(e,t){if("object"!=typeof e)throw Error("requestParams must be an object");return{...t?.params||{},...e||{}}}transformLocalMessage(e){return e}transformMessage(e){let{chunk:t,chunks:s,originMessage:r}=e;if(t)return t;if(Array.isArray(s)){let e=s?.length>0?s?.[s?.length-1]:void 0;return r||e}return s}}class n extends t{transformParams(e,t){return{...t?.params||{},...e,messages:this.getMessages()}}transformLocalMessage(e){return e?.messages||[]}transformMessage(e){let{originMessage:t,chunk:s,responseHeaders:r}=e,n="",o="assistant";try{let e;r.get("content-type")?.includes("text/event-stream")?s&&s.data?.trim()!=="[DONE]"&&(e=JSON.parse(s.data)):e=s,e&&e?.choices?.forEach(e=>{e?.delta?(n+=e.delta.content||"",o=e.delta.role||"assistant"):e?.message&&(n+=e.message.content||"",o=e.message.role||"assistant")})}catch(e){console.error("transformMessage error",e)}return{content:`${t?.content||""}${n||""}`,role:o}}}e.s(["AbstractChatProvider",()=>t,"DeepSeekChatProvider",()=>s,"DefaultChatProvider",()=>r,"OpenAIChatProvider",()=>n],297),e.i(297);var o,i=e.i(571),a=function(e){let t=i.useRef(e);return t.current=e,i.useCallback((...e)=>t.current?.(...e),[])};"undefined"!=typeof window&&window.document&&window.document.createElement?i.useLayoutEffect:i.useEffect,e.i(24),Symbol.for("react.element"),Symbol.for("react.transitional.element"),Symbol.for("react.fragment"),i.version.split(".")[0];let l={},u=[];function c(e,t){}function f(e,t){}function h(e,t,s){t||l[s]||(e(!1,s),l[s]=!0)}function m(e,t){h(c,e,t)}m.preMessage=e=>{u.push(e)},m.resetWarned=function(){l={}},m.noteOnce=function(e,t){h(f,e,t)};let d={_chatMessagesStores:new Map,get:e=>d._chatMessagesStores.get(e),set:(e,t)=>{d._chatMessagesStores.set(e,t)},delete:e=>{d._chatMessagesStores.delete(e)},getMessages:e=>{let t=d._chatMessagesStores.get(e);return t?.getMessages()}};class p{listeners=[];conversationKey;snapshotResult={messages:[],isDefaultMessagesRequesting:!1};throttleTimer=null;pendingEmit=!1;throttleInterval=50;isDestroyed=!1;emitListeners(){this.listeners.forEach(e=>{e()})}throttledEmitListeners(){this.throttleTimer?this.pendingEmit=!0:(this.emitListeners(),this.pendingEmit=!1,this.throttleTimer=setTimeout(()=>{this.throttleTimer=null,this.pendingEmit&&(this.emitListeners(),this.pendingEmit=!1)},this.throttleInterval))}constructor(e,t){this.initializeMessages(e,e=>{this.setSnapshotResult("isDefaultMessagesRequesting",e),this.emitListeners()}),t&&(this.conversationKey=t,d.set(this.conversationKey,this))}async initializeMessages(e,t){try{t(!0);let s=await e();this.isDestroyed||this.setMessagesInternal(s,!1)}catch(e){console.warn("Failed to initialize messages:",e),this.isDestroyed||this.setMessagesInternal([],!1)}finally{t(!1)}}setSnapshotResult=(e,t)=>{this.snapshotResult={...this.snapshotResult,[e]:t}};setMessagesInternal=(e,t=!0)=>{let s;return s="function"==typeof e?e(this.snapshotResult.messages):e,this.setSnapshotResult("messages",s),t?this.throttledEmitListeners():this.emitListeners(),!0};setMessages=e=>this.setMessagesInternal(e,!0);getMessages=()=>this.snapshotResult.messages;getMessage=e=>this.getMessages().find(t=>t.id===e);addMessage=e=>!this.getMessage(e.id)&&(this.setMessages([...this.snapshotResult.messages,e]),!0);setMessage=(e,t)=>{let s=this.getMessage(e);if(s){let e="function"==typeof t?t(s):t;return Object.assign(s,e),this.setMessages([...this.snapshotResult.messages]),!0}return!1};removeMessage=e=>{let t=this.getMessages().findIndex(t=>t.id===e);return -1!==t&&(this.snapshotResult.messages.splice(t,1),this.setMessages([...this.getMessages()]),!0)};getSnapshot=()=>this.snapshotResult;subscribe=e=>(this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e),0===this.listeners.length&&(this.throttleTimer&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.pendingEmit=!1)});destroy=()=>{this.isDestroyed=!0,this.throttleTimer&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.pendingEmit=!1,this.listeners=[]}}var g=((o=g||{}).local="local",o.loading="loading",o.updating="updating",o.success="success",o.error="error",o.abort="abort",o);let y=new Map;function b(e){let{defaultMessages:t,requestFallback:s,requestPlaceholder:r,parser:n,provider:o,conversationKey:l}=e,u=i.default.useRef(0),c=i.default.useRef(void 0),[f,h]=(0,i.useState)(!1),[m,g]=(0,i.useState)(l||Symbol("ConversationKey"));(0,i.useEffect)(()=>{l&&g(l)},[l]);let{messages:b,isDefaultMessagesRequesting:v,removeMessage:S,setMessages:M,getMessages:w,setMessage:C}=function(e,t){let s=()=>d.get(t)?d.get(t):new p(e,t),[r,n]=(0,i.useState)(s);(0,i.useEffect)(()=>{n(s())},[t]);let{messages:o,isDefaultMessagesRequesting:a}=(0,i.useSyncExternalStore)(r.subscribe,r.getSnapshot,r.getSnapshot);return{messages:o,isDefaultMessagesRequesting:a,addMessage:r.addMessage,removeMessage:r.removeMessage,setMessage:r.setMessage,getMessage:r.getMessage,setMessages:r.setMessages,getMessages:r.getMessages}}(async()=>(("function"==typeof t?await t({conversationKey:l}):t)||[]).map((e,t)=>({id:`default_${t}`,status:"local",...e})),m),T=(e,t,s)=>{let r={id:`msg_${u.current}`,message:e,status:t};return s&&(r.extraInfo=s),u.current+=1,r},E=i.default.useMemo(()=>{let e=[];return b.forEach(t=>{var s;let r=Array.isArray(s=n?n(t.message):t.message)?s:[s];r.forEach((s,n)=>{let o=t.id;r.length>1&&(o=`${o}_${n}`),e.push({id:o,message:s,status:t.status})})}),e},[b]),R=e=>e.filter(e=>"loading"!==e.status).map(e=>e.message);o?.injectGetMessages(()=>R(w())),c.current=o?.request;let _=(e,t)=>{if(!o)return;let{updatingId:n,reload:i}=t||{},a=null,l=o.transformLocalMessage(e),u=(Array.isArray(l)?l:[l]).map(e=>T(e,"local",t?.extraInfo));i?(a=n,M(s=>{let o=[...s];if(r){let s;s="function"==typeof r?r(e,{messages:R(o)}):r,o.forEach(e=>{e.id===n&&(e.status="loading",e.message=s,t?.extraInfo&&(e.extraInfo=t?.extraInfo))})}return o})):M(t=>{let s=[...t,...u];if(r){let t=T("function"==typeof r?r(e,{messages:R(s)}):r,"loading");a=t.id,s=[...s,t]}return s});let c=null,f=(e,t,s,r)=>{let l=w().find(e=>e.id===c);return l?M(n=>n.map(n=>{if(n.id===c){let i=o.transformMessage({originMessage:n.message,chunk:t,chunks:s,status:e,responseHeaders:r});return{...n,message:i,status:e}}return n})):i&&n?(l=w().find(e=>e.id===n))&&(l.status=e,l.message=o.transformMessage({chunk:t,status:e,chunks:s,responseHeaders:r}),M(e=>[...e]),c=l.id):(l=T(o.transformMessage({chunk:t,status:e,chunks:s,responseHeaders:r}),e),M(e=>[...e.filter(e=>e.id!==a),l]),c=l.id),l=w().find(e=>e.id===c)||l};o.injectRequest({onUpdate:(e,t)=>f("updating",e,[],t),onSuccess:(e,t)=>(h(!1),m&&y.delete(m),f("success",void 0,e,t)),onError:async(t,r)=>{let n;if(h(!1),m&&y.delete(m),s){if("function"==typeof s){let o=R(w()),i=w().find(e=>e.id===a||e.id===c);n=await s(e,{error:t,errorInfo:r,messageInfo:i,messages:o})}else n=s;M(e=>[...e.filter(e=>e.id!==a&&e.id!==c),T(n,"AbortError"===t.name?"abort":"error")])}else n=w().find(e=>e.id!==a&&e.id!==c),M(e=>e.map(e=>e.id===a||e.id===c?{...e,status:"AbortError"===t.name?"abort":"error"}:e));return n}}),h(!0),m&&y.set(m,!0),o.request.run(o.transformParams(e,o.request.options))};return{onRequest:a((e,t)=>{if(!o)throw Error("provider is required");_(e,t)}),isDefaultMessagesRequesting:v,messages:b,parsedMessages:E,setMessages:M,removeMessage:S,setMessage:C,abort:()=>{if(!o)throw Error("provider is required");c.current?.abort()},isRequesting:m?y?.get(m)||!1:f,onReload:(e,t,s)=>{if(!o)throw Error("provider is required");if(!e||!w().find(t=>t.id===e))throw Error(`message [${e}] is not found`);_(t,{updatingId:e,reload:!0,extraInfo:s?.extraInfo})}}}let v={_allConversationStores:new Map,set:(e,t)=>{v._allConversationStores.set(e,t)},delete:e=>{v._allConversationStores.delete(e)},getConversation:e=>{for(let t of v._allConversationStores.values())if(t){let s=t.getConversation(e);if(s)return s}}};class S{conversations=[];listeners=[];storeKey;activeConversationKey;emitListeners(){this.listeners.forEach(e=>{e()})}constructor(e,t){this.setConversations(e),this.storeKey=Math.random().toString(),v.set(this.storeKey,this),this.activeConversationKey=t}setActiveConversationKey=e=>(this.activeConversationKey=e,this.emitListeners(),!0);setConversations=e=>(this.conversations=[...e],this.emitListeners(),!0);getConversation=e=>this.conversations.find(t=>t.key===e);addConversation=(e,t)=>!this.getConversation(e.key)&&(this.setConversations("prepend"===t?[e,...this.conversations]:[...this.conversations,e]),!0);setConversation=(e,t)=>{let s=this.getConversation(e);return!!s&&(Object.assign(s,t),this.setConversations([...this.conversations]),!0)};removeConversation=e=>{let t=this.conversations.findIndex(t=>t.key===e);return -1!==t&&(this.conversations.splice(t,1),this.setConversations([...this.conversations]),!0)};getMessages=e=>d.getMessages(e);getSnapshot=()=>this.conversations;getActiveConversationKey=()=>this.activeConversationKey;subscribe=e=>(this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)});destroy=()=>{v.delete(this.storeKey)}}function M(e){let[t]=(0,i.useState)(()=>new S(e?.defaultConversations||[],e?.defaultActiveConversationKey||""));return(0,i.useEffect)(()=>()=>{t.destroy()},[]),{conversations:(0,i.useSyncExternalStore)(t.subscribe,t.getSnapshot,t.getSnapshot),activeConversationKey:(0,i.useSyncExternalStore)(t.subscribe,t.getActiveConversationKey,t.getActiveConversationKey),setActiveConversationKey:t.setActiveConversationKey,addConversation:t.addConversation,removeConversation:t.removeConversation,setConversation:t.setConversation,getConversation:t.getConversation,setConversations:t.setConversations,getMessages:t.getMessages}}let w=e=>""!==(e??"").trim();var C=function(e){let{readableStream:t,transformStream:s,streamSeparator:r,partSeparator:n,kvSeparator:o}=e;if(!(t instanceof ReadableStream))throw Error("The options.readableStream must be an instance of ReadableStream.");let i=function(){if("undefined"!=typeof TextDecoderStream)return new TextDecoderStream;let e=new TextDecoder("utf-8");return new TransformStream({transform(t,s){s.enqueue(e.decode(t,{stream:!0}))},flush(t){t.enqueue(e.decode())}})}(),a=s?t.pipeThrough(i).pipeThrough(s):t.pipeThrough(i).pipeThrough(function(e="\n\n"){let t="";return new TransformStream({transform(s,r){let n=(t+=s).split(e);n.slice(0,-1).forEach(e=>{w(e)&&r.enqueue(e)}),t=n[n.length-1]},flush(e){w(t)&&e.enqueue(t)}})}(r)).pipeThrough(function(e="\n",t=":"){return new TransformStream({transform(s,r){let n=s.split(e).reduce((e,s)=>{let r=s.indexOf(t);if(-1===r)return console.warn(`The key-value separator "${t}" is not found in the sse line: ${s} !`),e;let n=s.slice(0,r).trim();if(!w(n))return e;let o=s.slice(r+1).trim();return{...e,[n]:o}},{});0!==Object.keys(n).length&&r.enqueue(n)}})}(n,o));return a[Symbol.asyncIterator]=async function*(){let e=this.getReader();for(;;){let{done:t,value:s}=await e.read();if(t)break;s&&(yield s)}},a};let T=async(e,t)=>{let{fetch:s=globalThis.fetch,middlewares:r={},...n}=t;if("function"!=typeof s)throw Error("The options.fetch must be a typeof fetch function!");let o=[e,n];"function"==typeof r.onRequest&&(o=await r.onRequest(...o));let i=await s(...o);if("function"==typeof r.onResponse){let e=await r.onResponse(i);if(!(e instanceof Response))throw Error("The options.onResponse must return a Response instance!");i=e}if(!i.ok)throw Error(`Fetch failed with status ${i.status}`);if(!i.body)throw Error("The response body is empty.");return i},E={"Content-Type":"application/json"};class R{baseURL;options;constructor(e,t){if(!e||"string"!=typeof e)throw Error("The baseURL is not valid!");this.baseURL=e,this.options=t||{}}}class _ extends R{_asyncHandler;timeoutHandler;_isTimeout=!1;streamTimeoutHandler;_isStreamTimeout=!1;abortController;_isRequesting=!1;_manual=!1;lastManualParams;retryTimes=0;retryTimer;lastEventId=void 0;get asyncHandler(){return this._asyncHandler}get isTimeout(){return this._isTimeout}set isTimeout(e){this._isTimeout=e}get isStreamTimeout(){return this._isStreamTimeout}set isStreamTimeout(e){this._isStreamTimeout=e}get isRequesting(){return this._isRequesting}get manual(){return this._manual}constructor(e,t){super(e,t),this._manual=t?.manual||!1,this.manual||this.init()}run(e){return this.manual?(this.resetRetry(),this.lastManualParams=e,this.init(e),!0):(console.warn("The request is not manual, so it cannot be run!"),!1)}abort(){clearTimeout(this.timeoutHandler),clearTimeout(this.streamTimeoutHandler),this.abortController.abort()}init(e,t){this.abortController=new AbortController;let{callbacks:s,params:r,headers:n={},transformStream:o,fetch:i,timeout:a,streamTimeout:l,middlewares:u,streamSeparator:c,partSeparator:f,kvSeparator:h,...m}=this.options,d=Object.assign({},E||{},n,t||{}),p={...m,method:"POST",body:JSON.stringify({...r,...e||{}}),params:{...r,...e},headers:d,signal:this.abortController.signal,middlewares:u};a&&a>0&&(this.timeoutHandler=window.setTimeout(()=>{this.isTimeout=!0,this.finishRequest(),s?.onError?.(Error("TimeoutError"))},a)),this.startRequest(),this._asyncHandler=T(this.baseURL,{fetch:i,...p}).then(async e=>{if(clearTimeout(this.timeoutHandler),this.isTimeout)return;if(o){let t=o;"function"==typeof o&&(t=o(this.baseURL,e.headers)),await this.customResponseHandler(e,s,t,l,c,f,h);return}let t=e.headers.get("content-type")||"";switch(t.split(";")[0].trim()){case"text/event-stream":await this.sseResponseHandler(e,s,l,c,f,h);break;case"application/json":await this.jsonResponseHandler(e,s);break;default:throw Error(`The response content-type: ${t} is not support!`)}}).catch(e=>{clearTimeout(this.timeoutHandler),this.finishRequest();let t=e instanceof Error||e instanceof DOMException?e:Error("Unknown error!"),r=s?.onError?.(t);if("AbortError"!==t.name){let e="number"==typeof r?r:this.options.retryInterval;if(e&&e>0){if("number"==typeof this.options.retryTimes&&this.retryTimes>=this.options.retryTimes)return;clearTimeout(this.retryTimer),this.retryTimer=setTimeout(()=>{let e={};void 0!==this.lastEventId&&(e["Last-Event-ID"]=this.lastEventId),this.init(this.lastManualParams,e)},e),this.retryTimes=this.retryTimes+1}}})}startRequest(){this._isRequesting=!0}finishRequest(){this._isRequesting=!1}customResponseHandler=async(e,t,s,r,n,o,i)=>{let a=C({readableStream:e.body,transformStream:s,streamSeparator:n,partSeparator:o,kvSeparator:i});await this.processStream(a,e,t,r)};sseResponseHandler=async(e,t,s,r,n,o)=>{let i=C({readableStream:e.body,streamSeparator:r,partSeparator:n,kvSeparator:o});await this.processStream(i,e,t,s)};async processStream(e,t,s,r){let n,o=[],i=e[Symbol.asyncIterator]();do{if(r&&(this.streamTimeoutHandler=window.setTimeout(()=>{this.isStreamTimeout=!0,this.finishRequest(),s?.onError?.(Error("StreamTimeoutError"),void 0,t.headers)},r)),n=await i.next(),clearTimeout(this.streamTimeoutHandler),this.isStreamTimeout)break;n.value&&(o.push(n.value),s?.onUpdate?.(n.value,t.headers),void 0!==n?.value?.id&&(this.lastEventId=n.value.id))}while(!n.done)r&&(clearTimeout(this.streamTimeoutHandler),this.isStreamTimeout)?this.finishRequest():(this.finishRequest(),s?.onSuccess?.(o,t.headers))}jsonResponseHandler=async(e,t)=>{let s=await e.json();if(s?.success===!1){let r=Error(s.message||"System error");r.name=s.name||"SystemError",t?.onError?.(r,s,e.headers)}else t?.onUpdate?.(s,e.headers),this.finishRequest(),t?.onSuccess?.([s],e.headers)};resetRetry(){clearTimeout(this.retryTimer),this.retryTimes=0,this.lastEventId=void 0}}e.s(["AbstractChatProvider",()=>t,"AbstractXRequestClass",()=>R,"DeepSeekChatProvider",()=>s,"DefaultChatProvider",()=>r,"OpenAIChatProvider",()=>n,"XRequest",0,function(e,t){return new _(e,t)},"XStream",0,C,"useXChat",()=>b,"useXConversations",()=>M],643)}},{otherChunks:[],runtimeModuleIds:[643]}]]);

//# sourceMappingURL=x-sdk.min.js.map